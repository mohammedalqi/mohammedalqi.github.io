<!doctype html>
<html>
<head><meta charset="utf-8"><title>Fetch then blob</title></head>
<body>
  <h2>Fetch → blob → object URL (in-memory)</h2>
  <p><button id="dl">Fetch & Download</button></p>
  <p>Expected: download originated from the page (or shown originless) in some browsers.</p>

<script>
document.getElementById('dl').addEventListener('click', async () => {
  try {
    const res = await fetch('/test.apk', {cache: 'no-store'});
    if (!res.ok) throw new Error('fetch failed');
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'test.apk';
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 20000);
  } catch (e) {
    alert('Fetch failed: '+e);
  }
});
</script>
</body>
</html>
